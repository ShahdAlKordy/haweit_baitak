<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‡ÙˆÙŠØ© Ø¨ÙŠØªÙƒ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°ÙƒÙŠ</title>
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f0f4f8; color: #1e293b; }
        .sidebar { background: linear-gradient(180deg, #142952 0%, #0a1631 100%); }
        .active-tab { background: rgba(255, 255, 255, 0.15); border-right: 4px solid #fbbf24; }
        .card { background: white; border-radius: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .btn-primary { background-color: #142952; color: white; transition: all 0.3s; }
        .btn-primary:hover { background-color: #1d3a73; transform: translateY(-2px); }
        
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .invoice-page { page-break-after: always; padding: 20px; }
        }
        .print-only { display: none; }
        
        /* Animations */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen flex overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="sidebar w-72 text-white flex flex-col no-print">
            <div class="p-8 text-center border-b border-white/10">
                <div class="w-24 h-24 bg-white rounded-3xl mx-auto mb-4 flex items-center justify-center p-3 shadow-2xl">
                    <img src="https://i.ibb.co/68vD84D/logo1.png" alt="Logo" class="w-full h-full object-contain">
                </div>
                <h1 class="text-2xl font-black tracking-tight">Ù‡ÙˆÙŠØ© Ø¨ÙŠØªÙƒ</h1>
                <p class="text-blue-300 text-[10px] mt-1 uppercase tracking-widest font-bold">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
            </div>
            
            <nav class="flex-1 py-8 px-4 space-y-2 overflow-y-auto">
                <button @click="setTab('create')" :class="{'active-tab': activeTab === 'create'}" class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all font-bold">
                    <i data-lucide="plus-circle" class="w-5 h-5 text-yellow-400"></i> ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨
                </button>
                <button @click="setTab('archive')" :class="{'active-tab': activeTab === 'archive'}" class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all font-bold">
                    <i data-lucide="layout-grid" class="w-5 h-5 text-yellow-400"></i> Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                </button>
                <button @click="setTab('invoices')" :class="{'active-tab': activeTab === 'invoices'}" class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all font-bold">
                    <i data-lucide="printer" class="w-5 h-5 text-yellow-400"></i> Ù…Ø±ÙƒØ² Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                </button>
                <button @click="setTab('catalog')" :class="{'active-tab': activeTab === 'catalog'}" class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all font-bold">
                    <i data-lucide="settings" class="w-5 h-5 text-yellow-400"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                </button>
            </nav>

            <div class="p-6 bg-black/20 text-[10px] text-center text-blue-300">
                <p>Ù…ØªØµÙ„ Ø¨Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª: </p>
                <p class="truncate opacity-50">{{ sheetUrl }}</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 h-screen overflow-y-auto p-8 relative no-print">
            
            <!-- Toast Notification -->
            <transition name="fade">
                <div v-if="notification" class="fixed bottom-10 left-10 z-50 p-5 rounded-2xl shadow-2xl flex items-center gap-4 bg-white border-r-8" :class="notification.type === 'error' ? 'border-red-500' : 'border-green-500'">
                    <div class="bg-gray-100 p-2 rounded-full">
                        <i v-if="notification.type === 'success'" data-lucide="check" class="text-green-500"></i>
                        <i v-else data-lucide="alert-triangle" class="text-red-500"></i>
                    </div>
                    <div>
                        <p class="font-black text-[#142952]">{{ notification.msg }}</p>
                    </div>
                </div>
            </transition>

            <!-- Loading Overlay -->
            <div v-if="loading" class="absolute inset-0 bg-white/60 z-40 flex flex-col items-center justify-center backdrop-blur-sm">
                <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-[#142952] mb-4"></div>
                <p class="font-black text-[#142952] animate-pulse">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>

            <header class="mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-4xl font-black text-[#142952]">
                        <span v-if="activeTab === 'create'">{{ editingOrder ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨' : 'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯' }}</span>
                        <span v-if="activeTab === 'archive'">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ</span>
                        <span v-if="activeTab === 'invoices'">Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span>
                        <span v-if="activeTab === 'catalog'">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                    </h2>
                    <p class="text-gray-400 font-bold mt-1">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ØªØ¬Ø± Ù‡ÙˆÙŠØ© Ø¨ÙŠØªÙƒ - Ù…ØªØ²Ø§Ù…Ù†</p>
                </div>
                <div v-if="activeTab === 'archive'" class="flex gap-2">
                    <button @click="syncWithSheet" class="btn-primary px-6 py-3 rounded-2xl font-black flex items-center gap-2 shadow-lg shadow-blue-900/20">
                        <i data-lucide="refresh-cw" :class="{'animate-spin': syncLoading}" class="w-4 h-4"></i>
                        Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
                    </button>
                </div>
            </header>

            <!-- Views -->
            <div class="max-w-7xl mx-auto">
                
                <!-- 1. Form Section -->
                <section v-if="activeTab === 'create'" class="card p-8 animate-in border border-white">
                    <form @submit.prevent="handleOrderSubmit" class="space-y-10">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 bg-blue-50/50 p-8 rounded-3xl border border-blue-100">
                            <div class="col-span-full flex items-center gap-2 font-black text-[#142952] text-lg mb-2">
                                <i data-lucide="user-check" class="text-blue-500"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-black text-gray-400 mr-2 uppercase">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                <input v-model="orderForm.client.name" required class="w-full p-3.5 border-2 border-white rounded-2xl bg-white shadow-sm focus:border-blue-500 outline-none">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-black text-gray-400 mr-2 uppercase">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                                <input v-model="orderForm.client.city" required class="w-full p-3.5 border-2 border-white rounded-2xl bg-white shadow-sm focus:border-blue-500 outline-none">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-black text-gray-400 mr-2 uppercase">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                                <input v-model="orderForm.client.phone" required class="w-full p-3.5 border-2 border-white rounded-2xl bg-white shadow-sm focus:border-blue-500 outline-none" dir="ltr">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-black text-gray-400 mr-2 uppercase">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„</label>
                                <input v-model="orderForm.client.address" required class="w-full p-3.5 border-2 border-white rounded-2xl bg-white shadow-sm focus:border-blue-500 outline-none">
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div class="flex justify-between items-center border-b pb-4">
                                <h3 class="text-xl font-black text-[#142952]">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
                                <button type="button" @click="addProductRow" class="text-blue-600 font-black hover:text-blue-800 flex items-center gap-2">
                                    <i data-lucide="plus" class="w-4 h-4"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                                </button>
                            </div>
                            
                            <div v-for="(p, index) in orderForm.products" :key="p.id" class="p-8 border-2 border-gray-50 rounded-3xl relative bg-gray-50/30 hover:bg-white transition-all group">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-gray-400 uppercase">Ø§Ù„Ù…Ù†ØªØ¬</label>
                                        <select v-model="p.productId" @change="syncProductData(p)" required class="w-full p-3 border-2 border-transparent rounded-2xl bg-white shadow-sm font-bold">
                                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬...</option>
                                            <option v-for="item in catalog" :value="item.id">{{ item.name }} ({{ item.price }} SAR)</option>
                                        </select>
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-gray-400 uppercase">Ø§Ù„Ù„ÙˆÙ†</label>
                                        <select v-model="p.color" class="w-full p-3 border-2 border-transparent rounded-2xl bg-white shadow-sm font-bold">
                                            <option value="silver">Ø³ÙŠÙ„ÙØ± (ÙØ¶ÙŠ)</option>
                                            <option value="gold">Ø¬ÙˆÙ„Ø¯ (Ø°Ù‡Ø¨ÙŠ)</option>
                                        </select>
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-gray-400 uppercase">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                                        <input v-model.number="p.count" type="number" min="1" class="w-full p-3 border-2 border-transparent rounded-2xl bg-white shadow-sm font-bold">
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-blue-600 uppercase">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ</label>
                                        <input v-model="p.nationalAddress" class="w-full p-3 border-2 border-blue-50 rounded-2xl bg-blue-50 shadow-sm font-bold" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-gray-400 uppercase">Ø±Ù‚Ù… Ø§Ù„ÙÙŠÙ„Ø§/Ø§Ù„Ø¨Ø§Ø¨</label>
                                        <input v-model="p.villaNo" class="w-full p-3 border-2 border-transparent rounded-2xl bg-white shadow-sm font-bold">
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-gray-400 uppercase">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªÙˆØ¨</label>
                                        <input v-model="p.customName" class="w-full p-3 border-2 border-transparent rounded-2xl bg-white shadow-sm font-bold">
                                    </div>
                                    <div class="lg:col-span-2 space-y-1">
                                        <label class="text-[10px] font-black text-gray-400 uppercase">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</label>
                                        <input v-model="p.notes" class="w-full p-3 border-2 border-transparent rounded-2xl bg-white shadow-sm font-bold">
                                    </div>
                                </div>
                                <button v-if="orderForm.products.length > 1" @click="removeProductRow(index)" type="button" class="absolute -top-3 -left-3 bg-red-500 text-white p-2.5 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>

                        <div class="flex justify-between items-center border-t border-gray-100 pt-10">
                            <div>
                                <p class="text-sm font-bold text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨:</p>
                                <p class="text-4xl font-black text-green-600">{{ calculateTotal() }} SAR</p>
                            </div>
                            <div class="flex gap-4">
                                <button v-if="editingOrder" type="button" @click="cancelEdit" class="bg-gray-100 px-10 py-5 rounded-3xl font-black text-gray-500">Ø¥Ù„ØºØ§Ø¡</button>
                                <button type="submit" :disabled="isSaving" class="btn-primary px-16 py-5 rounded-3xl font-black shadow-2xl flex items-center gap-3">
                                    <span v-if="!isSaving">{{ editingOrder ? 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨' : 'ØªØ£ÙƒÙŠØ¯ ÙˆØ­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨' }}</span>
                                    <span v-else class="flex items-center gap-2"><i data-lucide="loader" class="animate-spin w-5 h-5"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </section>

                <!-- 2. Archive Section -->
                <section v-if="activeTab === 'archive'" class="card p-0 overflow-hidden animate-in">
                    <div class="p-8 bg-gray-50 border-b flex justify-between items-center">
                        <div class="relative w-96">
                            <i data-lucide="search" class="absolute right-4 top-3.5 text-gray-400 w-5 h-5"></i>
                            <input v-model="searchQuery" class="w-full pr-12 pl-6 py-3.5 bg-white border-2 border-transparent rounded-2xl shadow-sm focus:border-blue-500 outline-none font-bold" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨...">
                        </div>
                        <p class="text-gray-400 font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: <span class="text-[#142952] font-black">{{ filteredOrders.length }}</span></p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-right border-collapse">
                            <thead>
                                <tr class="bg-[#142952] text-white">
                                    <th class="p-6 font-black">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th class="p-6 font-black">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="p-6 font-black">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th class="p-6 font-black">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                    <th class="p-6 font-black">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th class="p-6 font-black text-center">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="order in filteredOrders" :key="order.id" class="border-b hover:bg-blue-50/50 transition-colors">
                                    <td class="p-6 font-mono font-black text-blue-700 tracking-tighter">{{ order.orderId }}</td>
                                    <td class="p-6 text-xs text-gray-500 font-bold">
                                        {{ formatDate(order.timestamp) }}<br/>{{ formatTime(order.timestamp) }}
                                    </td>
                                    <td class="p-6">
                                        <div class="font-black text-gray-800">{{ order.client.name }}</div>
                                        <div class="text-[10px] text-gray-400" dir="ltr">{{ order.client.phone }}</div>
                                    </td>
                                    <td class="p-6 max-w-xs truncate font-bold text-gray-500" :title="order.client.address">{{ order.client.address }}</td>
                                    <td class="p-6 font-black text-green-600">{{ order.totalAmount }} SAR</td>
                                    <td class="p-6">
                                        <div class="flex justify-center gap-2">
                                            <button @click="viewInvoice(order)" class="p-3 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-600 hover:text-white transition-all shadow-sm"><i data-lucide="eye" class="w-4 h-4"></i></button>
                                            <button @click="editOrder(order)" class="p-3 bg-yellow-50 text-yellow-600 rounded-xl hover:bg-yellow-600 hover:text-white transition-all shadow-sm"><i data-lucide="edit-3" class="w-4 h-4"></i></button>
                                            <button @click="deleteOrder(order)" class="p-3 bg-red-50 text-red-500 rounded-xl hover:bg-red-500 hover:text-white transition-all shadow-sm"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- 3. Invoices Section -->
                <section v-if="activeTab === 'invoices'" class="animate-in space-y-8">
                    <div class="card p-8 flex flex-col md:flex-row justify-between items-center gap-6">
                        <div class="flex items-center gap-6">
                            <label class="font-black text-[#142952]">Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„ÙÙˆØ§ØªÙŠØ±:</label>
                            <input type="date" v-model="filterDate" class="border-2 border-blue-50 p-3 rounded-2xl outline-none focus:ring-4 focus:ring-blue-100 bg-gray-50 font-bold">
                        </div>
                        <div class="flex flex-wrap gap-4">
                            <button @click="printBulk" class="btn-primary px-8 py-4 rounded-2xl font-black flex items-center gap-2 shadow-xl">
                                <i data-lucide="printer" class="w-5 h-5 text-yellow-400"></i> Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¬Ù…Ø¹Ø©
                            </button>
                            <button @click="downloadBulkPDF" class="bg-blue-600 text-white px-8 py-4 rounded-2xl font-black flex items-center gap-2 shadow-xl hover:bg-blue-700">
                                <i data-lucide="file-down" class="w-5 h-5"></i> ØªØ­Ù…ÙŠÙ„ PDF Ù…Ø¬Ù…Ø¹
                            </button>
                            <button @click="downloadZIP" class="bg-green-600 text-white px-8 py-4 rounded-2xl font-black flex items-center gap-2 shadow-xl hover:bg-green-700">
                                <i data-lucide="package" class="w-5 h-5"></i> ØªØ­Ù…ÙŠÙ„ ZIP ÙÙˆØ§ØªÙŠØ±
                            </button>
                        </div>
                    </div>

                    <div v-if="filteredByDateOrders.length === 0" class="card py-32 text-center border-4 border-dashed border-gray-50 shadow-none">
                        <i data-lucide="inbox" class="w-20 h-20 text-gray-200 mx-auto mb-6"></i>
                        <p class="text-gray-400 font-black text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®</p>
                    </div>

                    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div v-for="order in filteredByDateOrders" :key="order.id" class="card p-8 hover:border-blue-500 border-2 border-transparent transition-all group cursor-pointer" @click="viewInvoice(order)">
                            <div class="flex justify-between items-start mb-6">
                                <span class="bg-blue-50 text-blue-700 px-4 py-1.5 rounded-full text-xs font-black tracking-widest">{{ order.orderId }}</span>
                                <span class="text-[10px] font-bold text-gray-300">{{ formatTime(order.timestamp) }}</span>
                            </div>
                            <h4 class="font-black text-[#142952] text-xl mb-2">{{ order.client.name }}</h4>
                            <p class="text-xs text-gray-500 line-clamp-1 mb-6">ğŸ“ {{ order.client.address }}</p>
                            <div class="flex justify-between items-center border-t border-dashed border-gray-100 pt-6">
                                <span class="font-black text-green-600 text-xl">{{ order.totalAmount }} SAR</span>
                                <span class="text-blue-600 font-black text-sm group-hover:underline">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 4. Catalog Section -->
                <section v-if="activeTab === 'catalog'" class="card p-8 animate-in">
                    <form @submit.prevent="saveCatalogItem" class="flex flex-wrap gap-6 mb-12 p-8 bg-gray-50 rounded-3xl items-end border border-white">
                        <div class="flex-1 min-w-[280px]">
                            <label class="block text-xs font-black text-gray-400 mb-2 uppercase">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                            <input v-model="catalogForm.name" required class="w-full p-3.5 bg-white border-2 border-transparent rounded-2xl shadow-sm focus:border-blue-500 outline-none font-bold">
                        </div>
                        <div class="w-48">
                            <label class="block text-xs font-black text-gray-400 mb-2 uppercase">Ø§Ù„Ø³Ø¹Ø± (SAR)</label>
                            <input v-model.number="catalogForm.price" required type="number" class="w-full p-3.5 bg-white border-2 border-transparent rounded-2xl shadow-sm focus:border-blue-500 outline-none font-bold text-green-600">
                        </div>
                        <button type="submit" class="bg-[#142952] text-white px-12 py-3.5 rounded-2xl font-black h-[58px] shadow-lg">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø±</button>
                    </form>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div v-for="item in catalog" :key="item.id" class="p-8 border-2 border-gray-50 rounded-3xl flex justify-between items-center hover:border-blue-200 hover:shadow-2xl transition-all bg-white">
                            <div>
                                <h5 class="font-black text-[#142952] text-xl">{{ item.name }}</h5>
                                <p class="text-blue-600 font-black text-lg mt-1">{{ item.price }} SAR</p>
                            </div>
                            <button @click="deleteCatalogItem(item.id)" class="text-red-400 p-4 hover:bg-red-50 rounded-2xl transition-colors">
                                <i data-lucide="trash-2" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Hidden Printing Area -->
        <div id="print-wrapper" class="print-only" dir="rtl">
            <div v-for="invoice in bulkList" :key="invoice.id" :id="'invoice-' + invoice.orderId" class="invoice-page bg-white p-20 max-w-5xl mx-auto mb-10 border border-gray-100">
                <!-- Header -->
                <div class="flex justify-between items-start mb-16 pb-12 border-b-4 border-[#142952]">
                    <div class="space-y-4">
                        <h1 class="text-7xl font-black text-[#142952]">ÙØ§ØªÙˆØ±Ø©</h1>
                        <div class="space-y-1 text-gray-700 font-bold text-lg">
                            <p>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span class="text-black">#{{ invoice.orderId }}</span></p>
                            <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨: {{ formatDate(invoice.timestamp) }}</p>
                            <p>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ: 310236446600003</p>
                        </div>
                    </div>
                    <div class="text-left flex flex-col items-end">
                        <div class="w-32 h-32 bg-[#142952] rounded-3xl mb-4 flex items-center justify-center p-4">
                            <img src="https://i.ibb.co/68vD84D/logo1.png" alt="Logo" class="w-full h-full object-contain filter invert">
                        </div>
                        <p class="font-black text-3xl text-[#142952]">Ù‡ÙˆÙŠØ© Ø¨ÙŠØªÙƒ</p>
                        <p class="text-gray-500 font-bold text-xl">Ù„Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§Ø®Ø±Ø©</p>
                    </div>
                </div>

                <!-- Info Cards -->
                <div class="grid grid-cols-2 gap-12 mb-16">
                    <div class="bg-gray-50 p-10 rounded-[3rem] border-2 border-gray-100">
                        <h3 class="font-black text-[#142952] border-b-2 border-gray-200 mb-6 pb-2 text-2xl uppercase tracking-tighter">Ù…ØµØ¯Ø±Ø© Ø¥Ù„Ù‰:</h3>
                        <p class="font-black text-3xl mb-3 text-gray-900">{{ invoice.client.name }}</p>
                        <p class="text-xl text-gray-600 mb-2">{{ invoice.client.city }}</p>
                        <p class="text-xl font-black text-[#142952] underline decoration-blue-200">{{ invoice.client.address }}</p>
                        <p class="text-2xl mt-6 font-black text-gray-800" dir="ltr">{{ invoice.client.phone }}</p>
                    </div>
                    <div class="bg-gray-50 p-10 rounded-[3rem] border-2 border-gray-100">
                        <h3 class="font-black text-[#142952] border-b-2 border-gray-200 mb-6 pb-2 text-2xl uppercase tracking-tighter">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø­Ù†:</h3>
                        <p class="font-black text-xl text-gray-700">Ø¨ÙˆØ§Ø³Ø·Ø©: Ù…Ù†Ø¯ÙˆØ¨Ù†Ø§</p>
                        <p class="text-lg text-gray-600 mt-2">ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„: (7 - 12 ÙŠÙˆÙ… Ø¹Ù…Ù„)</p>
                        <p class="text-lg text-gray-600 font-bold mt-4">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„:</p>
                        <p class="text-lg font-bold" dir="ltr">+966 54 478 2301</p>
                    </div>
                </div>

                <!-- Products Table -->
                <table class="w-full mb-12 border-collapse overflow-hidden rounded-[2rem] border-4 border-gray-50 shadow-sm">
                    <thead class="bg-[#142952] text-white">
                        <tr>
                            <th class="p-8 text-right text-xl font-black">Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©</th>
                            <th class="p-8 text-center text-xl font-black">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th class="p-8 text-left text-xl font-black">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="p in invoice.products" :key="p.id" class="border-b-2 border-gray-50 bg-white">
                            <td class="p-8">
                                <div class="font-black text-2xl text-gray-900 mb-3">{{ p.name }}</div>
                                <div class="space-y-2">
                                    <div class="flex items-center gap-6 text-lg text-gray-500 font-bold">
                                        <span>Ø§Ù„Ù„ÙˆÙ†: <span class="text-black">{{ p.color === 'silver' ? 'ÙØ¶ÙŠ' : 'Ø°Ù‡Ø¨ÙŠ' }}</span></span>
                                        <span v-if="p.nationalAddress" class="bg-blue-50 text-blue-700 px-4 py-1 rounded-full text-sm font-black">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ: {{ p.nationalAddress }}</span>
                                    </div>
                                    <p v-if="p.customName" class="text-[#142952] font-black text-xl italic border-r-8 border-blue-500 pr-4 mt-4 bg-blue-50 py-3 rounded-xl">
                                        Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªÙˆØ¨: {{ p.customName }}
                                    </p>
                                    <p v-if="p.villaNo" class="text-gray-400 font-bold text-sm">Ø±Ù‚Ù… Ø§Ù„ÙÙŠÙ„Ø§/Ø§Ù„Ø¨Ø§Ø¨: {{ p.villaNo }}</p>
                                </div>
                            </td>
                            <td class="p-8 text-center text-3xl font-black text-[#142952] bg-gray-50/30">{{ p.count }}</td>
                            <td class="p-8 text-left font-black text-3xl text-green-700">{{ p.price * p.count }} SAR</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Summary -->
                <div class="flex justify-end pt-12">
                    <div class="w-96 bg-[#142952] text-white p-10 rounded-[3rem] shadow-2xl space-y-6">
                        <div class="flex justify-between items-center opacity-70 border-b border-white/10 pb-3">
                            <span class="font-bold text-xl">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ù„Ø©</span>
                            <span class="font-black text-2xl">{{ invoice.totalAmount }} SAR</span>
                        </div>
                        <div class="flex justify-between items-center text-green-400 border-b border-white/10 pb-3">
                            <span class="font-bold text-xl">ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†</span>
                            <span class="font-black text-2xl">Ù…Ø¬Ø§Ù†Ø§Ù‹</span>
                        </div>
                        <div class="flex justify-between items-center pt-2">
                            <span class="font-black text-2xl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨</span>
                            <span class="text-5xl font-black">{{ invoice.totalAmount }} SAR</span>
                        </div>
                    </div>
                </div>

                <div class="mt-40 text-center border-t pt-10 border-gray-100">
                    <p class="text-gray-300 font-black italic text-lg uppercase tracking-widest">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… Ø¨Ù‡ÙˆÙŠØ© Ø¨ÙŠØªÙƒ - Ù†Ø³Ø¹Ø¯ Ø¨Ø®Ø¯Ù…ØªÙƒÙ… Ø¯Ø§Ø¦Ù…Ø§Ù‹</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, setDoc, getDocs, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const { createApp, ref, computed, onMounted, watchEffect, nextTick } = Vue;

        const firebaseConfig = JSON.parse(__firebase_config || '{}');
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'hwayt-bytk-v1';
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxa6rmwo_4kCorqvihWtNcgy6hlZKLMcSJnNr_m8kp0h-vLATsiUVcDyoUXuuQuJBTn/exec";

        createApp({
            setup() {
                const activeTab = ref('create');
                const user = ref(null);
                const orders = ref(JSON.parse(localStorage.getItem('hwayt_orders') || '[]'));
                const catalog = ref(JSON.parse(localStorage.getItem('hwayt_catalog') || '[]'));
                const loading = ref(true);
                const syncLoading = ref(false);
                const notification = ref(null);
                const searchQuery = ref('');
                const filterDate = ref(new Date().toISOString().split('T')[0]);
                const isSaving = ref(false);
                const bulkList = ref([]);
                const editingOrder = ref(null);
                const sheetUrl = ref(GOOGLE_SCRIPT_URL);

                const orderForm = ref({
                    client: { name: '', city: '', address: '', phone: '' },
                    products: [{ id: Date.now(), productId: '', name: '', nationalAddress: '', villaNo: '', customName: '', notes: '', count: 1, color: 'silver', price: 0 }]
                });

                const catalogForm = ref({ name: '', price: '' });

                onMounted(async () => {
                    const initAuth = async () => {
                        try {
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                await signInWithCustomToken(auth, __initial_auth_token);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (e) { console.error("Auth Failure:", e); }
                    };
                    await initAuth();

                    onAuthStateChanged(auth, (u) => {
                        user.value = u;
                        if (u) {
                            // Firebase Real-time Sync
                            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), (snap) => {
                                const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                                if (data.length > 0) {
                                    orders.value = data;
                                    localStorage.setItem('hwayt_orders', JSON.stringify(data));
                                }
                                loading.value = false;
                            }, (err) => { console.error(err); loading.value = false; });

                            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'catalog'), (snap) => {
                                const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                                if (data.length > 0) {
                                    catalog.value = data;
                                    localStorage.setItem('hwayt_catalog', JSON.stringify(data));
                                }
                            });
                        }
                    });
                });

                const showNotify = (msg, type = 'success') => {
                    notification.value = { msg, type };
                    setTimeout(() => notification.value = null, 4000);
                    setTimeout(() => lucide.createIcons(), 100);
                };

                const setTab = (t) => {
                    activeTab.value = t;
                    setTimeout(() => lucide.createIcons(), 50);
                };

                const addProductRow = () => {
                    orderForm.value.products.push({ id: Date.now(), productId: '', name: '', nationalAddress: '', villaNo: '', customName: '', notes: '', count: 1, color: 'silver', price: 0 });
                };

                const removeProductRow = (idx) => { orderForm.value.products.splice(idx, 1); };

                const syncProductData = (p) => {
                    const item = catalog.value.find(c => c.id === p.productId);
                    if (item) { p.name = item.name; p.price = item.price; }
                };

                const calculateTotal = () => orderForm.value.products.reduce((sum, p) => sum + (p.price * p.count), 0);

                const handleOrderSubmit = async () => {
                    isSaving.value = true;
                    const orderId = editingOrder.value ? editingOrder.value.orderId : ('ORD-' + Math.random().toString(36).substr(2, 8).toUpperCase());
                    
                    const payload = {
                        orderId,
                        client: JSON.parse(JSON.stringify(orderForm.value.client)),
                        products: JSON.parse(JSON.stringify(orderForm.value.products)),
                        totalAmount: calculateTotal(),
                        timestamp: editingOrder.value ? editingOrder.value.timestamp : new Date().toISOString(),
                        action: editingOrder.value ? 'update' : 'create'
                    };

                    try {
                        // 1. Save to Firestore (Cloud)
                        if (editingOrder.value) {
                            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', editingOrder.value.id), payload);
                        } else {
                            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), payload);
                        }

                        // 2. Save to Google Sheet (External)
                        fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });

                        // 3. Update Local State
                        if (editingOrder.value) {
                            const idx = orders.value.findIndex(o => o.id === editingOrder.value.id);
                            orders.value[idx] = payload;
                        } else {
                            orders.value.unshift(payload);
                        }
                        localStorage.setItem('hwayt_orders', JSON.stringify(orders.value));

                        showNotify(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­: ${orderId}`);
                        cancelEdit();
                        setTab('archive');
                    } catch (e) { showNotify("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©", "error"); } finally { isSaving.value = false; }
                };

                const editOrder = (order) => {
                    editingOrder.value = order;
                    orderForm.value = {
                        client: JSON.parse(JSON.stringify(order.client)),
                        products: JSON.parse(JSON.stringify(order.products))
                    };
                    setTab('create');
                };

                const cancelEdit = () => {
                    editingOrder.value = null;
                    orderForm.value = {
                        client: { name: '', city: '', address: '', phone: '' },
                        products: [{ id: Date.now(), productId: '', name: '', nationalAddress: '', villaNo: '', customName: '', notes: '', count: 1, color: 'silver', price: 0 }]
                    };
                };

                const deleteOrder = async (order) => {
                    if (confirm(`Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ ${order.orderId}ØŸ`)) {
                        try {
                            if (order.id) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', order.id));
                            fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'delete', orderId: order.orderId }) });
                            orders.value = orders.value.filter(o => o.orderId !== order.orderId);
                            localStorage.setItem('hwayt_orders', JSON.stringify(orders.value));
                            showNotify("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­");
                        } catch (e) { showNotify("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù", "error"); }
                    }
                };

                const syncWithSheet = async () => {
                    syncLoading.value = true;
                    try {
                        const response = await fetch(GOOGLE_SCRIPT_URL);
                        const sheetData = await response.json();
                        
                        // Convert Flat sheet data back to our object structure
                        const grouped = {};
                        sheetData.forEach(row => {
                            if (!grouped[row['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨']]) {
                                grouped[row['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨']] = {
                                    orderId: row['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨'],
                                    client: { name: row['Ø§Ù„Ø¹Ù…ÙŠÙ„'], city: row['Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'], phone: row['Ø§Ù„Ø¬ÙˆØ§Ù„'], address: row['Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„'] },
                                    products: [],
                                    totalAmount: 0,
                                    timestamp: row['Ø§Ù„ØªØ§Ø±ÙŠØ®'] || new Date().toISOString()
                                };
                            }
                            const p = {
                                name: row['Ø§Ù„Ù…Ù†ØªØ¬'], color: row['Ø§Ù„Ù„ÙˆÙ†'], count: parseInt(row['Ø§Ù„Ø¹Ø¯Ø¯']), 
                                price: parseFloat(row['Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ']), nationalAddress: row['Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ'],
                                villaNo: row['Ø±Ù‚Ù… Ø§Ù„ÙÙŠÙ„Ø§'], customName: row['Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØµØµ'], notes: row['Ù…Ù„Ø§Ø­Ø¸Ø§Øª']
                            };
                            grouped[row['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨']].products.push(p);
                            grouped[row['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨']].totalAmount += (p.price * p.count);
                        });

                        const finalData = Object.values(grouped);
                        orders.value = finalData;
                        localStorage.setItem('hwayt_orders', JSON.stringify(finalData));
                        showNotify("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª");
                    } catch (e) { showNotify("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ Web App", "error"); } finally { syncLoading.value = false; }
                };

                const saveCatalogItem = async () => {
                    try {
                        const newItem = { ...catalogForm.value };
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'catalog'), newItem);
                        catalog.value.push(newItem);
                        localStorage.setItem('hwayt_catalog', JSON.stringify(catalog.value));
                        catalogForm.value = { name: '', price: '' };
                    } catch (e) { showNotify("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬", "error"); }
                };

                const deleteCatalogItem = async (id) => {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'catalog', id));
                    catalog.value = catalog.value.filter(i => i.id !== id);
                };

                // Printing & Exporting Logic
                const viewInvoice = (order) => {
                    bulkList.value = [order];
                    nextTick(() => setTimeout(() => window.print(), 500));
                };

                const printBulk = () => {
                    bulkList.value = filteredByDateOrders.value;
                    nextTick(() => setTimeout(() => window.print(), 500));
                };

                const downloadBulkPDF = async () => {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    showNotify("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„Ù€ PDF Ø§Ù„Ù…Ø¬Ù…Ø¹...", "success");
                    
                    for (let i = 0; i < filteredByDateOrders.value.length; i++) {
                        const order = filteredByDateOrders.value[i];
                        bulkList.value = [order];
                        await nextTick();
                        const element = document.getElementById('invoice-' + order.orderId);
                        const canvas = await html2canvas(element, { scale: 2 });
                        const imgData = canvas.toDataURL('image/png');
                        if (i > 0) pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
                    }
                    pdf.save(`ÙÙˆØ§ØªÙŠØ±_Ù‡ÙˆÙŠØ©_Ø¨ÙŠØªÙƒ_${filterDate.value}.pdf`);
                };

                const downloadZIP = async () => {
                    const zip = new JSZip();
                    const { jsPDF } = window.jspdf;
                    showNotify("Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙÙŠ Ù…Ù„Ù Ù…Ø¶ØºÙˆØ·...", "success");

                    for (const order of filteredByDateOrders.value) {
                        bulkList.value = [order];
                        await nextTick();
                        const element = document.getElementById('invoice-' + order.orderId);
                        const canvas = await html2canvas(element, { scale: 2 });
                        const imgData = canvas.toDataURL('image/png');
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
                        zip.file(`${order.orderId}.pdf`, pdf.output('blob'));
                    }
                    
                    zip.generateAsync({type:"blob"}).then(content => {
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(content);
                        link.download = `ÙÙˆØ§ØªÙŠØ±_Ù‡ÙˆÙŠØ©_Ø¨ÙŠØªÙƒ_${filterDate.value}.zip`;
                        link.click();
                    });
                };

                const filteredOrders = computed(() => {
                    const q = searchQuery.value.toUpperCase();
                    return orders.value.filter(o => 
                        o.orderId.includes(q) || 
                        (o.client?.name || "").includes(searchQuery.value)
                    ).sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
                });

                const filteredByDateOrders = computed(() => {
                    return orders.value.filter(o => (o.timestamp || "").split('T')[0] === filterDate.value);
                });

                const formatDate = (ts) => ts ? new Date(ts).toLocaleDateString('ar-SA', { year: 'numeric', month: 'long', day: 'numeric' }) : '-';
                const formatTime = (ts) => ts ? new Date(ts).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }) : '-';

                watchEffect(() => setTimeout(() => lucide.createIcons(), 100));

                return {
                    activeTab, orders, catalog, loading, syncLoading, notification, searchQuery, filterDate, isSaving,
                    orderForm, catalogForm, bulkList, editingOrder, sheetUrl,
                    addProductRow, removeProductRow, syncProductData, handleOrderSubmit, deleteOrder, editOrder, cancelEdit,
                    saveCatalogItem, deleteCatalogItem, viewInvoice, printBulk, downloadBulkPDF, downloadZIP, syncWithSheet, calculateTotal,
                    filteredOrders, filteredByDateOrders, formatDate, formatTime, setTab
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
